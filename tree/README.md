# AVL树的操作

## 删除

若要删除的结点要两个子女结点，首先要转换成删除只有一个子女的结点，与二叉查找树类似先找这个结点的前驱或者后继，然后把前驱或者后继的值赋给之前要删除的结点，并令前驱或者后继成为要删除的结点。

因为删除最后都会转化成删除只有至多一个子女的结点，所以这里只讨论这种情况。

### case1

$p_r$是要删除结点$p$的父结点，若$p_r$的平衡因子是$0$，则删除$p$后$p_r$的平衡因子变为$-1$或者$1$，且以$p_r$为根的平衡树高度不变，所以整个AVL​达到平衡，退出平衡过程，具体过程如下图。
![case1](https://i.loli.net/2020/11/19/N4MfoQajYKwdsPk.png)

### case2

$p_r$的平衡因为原来不为$0$，且较高的子树被缩短，则$p_r$的平衡因子改为$0$，以$p_r$为跟的子树达到平衡，不需要旋转，但是由于$p_r$的高度减一（不难理解），因此需要考察$p_r$的父结点的平衡情况。
![case2](https://i.loli.net/2020/11/19/rN2wSleVcMniP8h.png)

### case3

前两个都不需要旋转以$p_r$为结点的树，从case3开始就需要了。结点$p_r$的平衡因子原不为$0$，为$1$或$-1$，且较矮的子树又被缩短了，则在结点$p_r$需要旋转，令$q$为$p_r$里较高的子树，根据$q$的平衡因子不同又可分为下面三种操作。

#### 1

如果$q$的平衡因子为$0$，执行一个单旋操作来恢复结点$p_r$的平衡，这里只举左单旋转的例子，右单旋转可以对称地处理。由于平衡旋转后，$q$变为子树的新的根结点，以$q$为根的子树的高度没有发生变化，则整个AVL达到平衡可以退出平衡过程。
![case3_1](https://i.loli.net/2020/11/19/NLpTUHjfWFEr1OZ.png)

#### 2

如果q的平衡因子不为0，且与$p_r$的平衡因子同号，则执行一个单旋转来恢复平衡，这里只举左单旋转的例子，结点$p_r$和$q$的因子都变为$0$，此时以$q$为为新的根结点的子树高度降低1，所以需要继续考察其父结点的平衡情况。
![case3_2](https://i.loli.net/2020/11/19/TuQW5HaMKSpvolY.png)

#### 3

如果$p_r$与$q$的平衡因子异号，则需要先执行一个双旋来恢复这个子树的平衡，这里以右左旋为例子，旋转后新根节点的平衡因子置为0，其他结点的平衡因子要根据具体情况进行相应处理。因为新子树的高度减一，所以需要继续考察父结点的平衡情况。
![case3_3](https://i.loli.net/2020/11/19/rbFLue64NUZYlHv.png)